# AI 编程小助手 - 开发说明

## 快速开始

### Windows 系统快速启动
双击 `start.bat` 文件即可启动开发服务器

或者在命令行中运行：
```bash
npm run dev
```

## 项目架构

### 1. 核心功能模块

#### 聊天室组件 (`src/components/ChatRoom.vue`)
- **功能**：主要的聊天界面
- **特性**：
  - 消息展示（用户消息在右侧，AI消息在左侧）
  - 实时流式显示 AI 回复
  - 自动滚动到最新消息
  - 加载状态指示器
  - 多语言界面切换

#### API 服务 (`src/services/api.js`)
- **SSE 实现**：使用 EventSource API 实现服务器推送
- **会话管理**：自动生成和管理 memoryId
- **功能函数**：
  - `generateChatId()` - 生成唯一的聊天 ID
  - `getMemoryId()` - 获取或创建会话 ID
  - `chatWithSSE()` - SSE 通信核心函数

#### 多语言支持 (`src/i18n/index.js`)
- **支持语言**：中文、英文
- **持久化**：使用 localStorage 保存用户语言选择
- **响应式**：使用 Vue3 的 reactive API 实现响应式切换

### 2. 后端接口对接

#### 接口地址
```
GET https://localhost:8081/api/ai/chat
```

#### 请求参数
- `memoryId` (int) - 会话 ID，用于维护对话上下文
- `message` (string) - 用户发送的消息内容

#### 返回格式
SSE 流式数据，格式：
```
data: 响应文本块1
data: 响应文本块2
...
```

### 3. 代理配置

Vite 开发服务器配置了代理，将 `/api` 请求转发到后端：

```javascript
// vite.config.js
proxy: {
  '/api': {
    target: 'https://localhost:8081',
    changeOrigin: true,
    secure: false  // 允许自签名证书
  }
}
```

**注意**：`secure: false` 用于开发环境，生产环境应使用有效的 SSL 证书。

## UI 设计

### IntelliJ 风格主题
- **主要颜色**：
  - 背景：`#2b2b2b`
  - 组件背景：`#3c3f41`
  - 文本：`#a9b7c6`
  - 强调色：`#667eea` (渐变紫)

- **交互反馈**：
  - 悬停效果
  - 点击动画
  - 平滑过渡

- **消息气泡**：
  - AI 消息：深灰色背景，左侧显示
  - 用户消息：蓝色背景，右侧显示
  - 圆形头像标识

## 功能实现细节

### 1. SSE 实时通信

```javascript
const eventSource = new EventSource(url)

eventSource.onmessage = (event) => {
  // 接收到数据块
  const data = event.data
  // 追加到消息内容中
}

eventSource.onerror = (error) => {
  // 错误处理
  eventSource.close()
}
```

### 2. 会话管理

使用 `sessionStorage` 存储会话 ID：
- 页面刷新时保持会话
- 新标签页创建新会话
- 关闭标签页后会话重置

### 3. 消息滚动

使用 Vue3 的 `nextTick` 确保 DOM 更新后滚动：
```javascript
nextTick(() => {
  messagesContainer.value.scrollTop = 
    messagesContainer.value.scrollHeight
})
```

## 开发建议

### 1. 推荐开发工具
- **IDE**: Visual Studio Code
- **插件**: 
  - Volar (Vue Language Features)
  - ESLint
  - Prettier

### 2. 调试技巧

#### 查看 SSE 请求
1. 打开浏览器开发者工具
2. 切换到 Network 标签
3. 筛选 EventStream 类型
4. 查看实时数据流

#### 查看会话 ID
```javascript
console.log('Memory ID:', sessionStorage.getItem('memoryId'))
```

#### 测试多语言
```javascript
// 在浏览器控制台切换语言
localStorage.setItem('locale', 'zh')
location.reload()
```

### 3. 常见问题

#### Q: SSE 连接失败
**A**: 
1. 检查后端服务是否启动
2. 确认后端地址正确（https://localhost:8081）
3. 查看浏览器控制台错误信息

#### Q: 代理不工作
**A**: 
1. 重启开发服务器
2. 检查 vite.config.js 配置
3. 确认请求路径以 `/api` 开头

#### Q: 样式显示异常
**A**: 
1. 清除浏览器缓存
2. 检查 CSS 作用域（scoped）
3. 确认没有全局样式冲突

## 扩展建议

### 可以添加的功能
1. **历史记录**：保存聊天历史到本地
2. **多会话管理**：支持创建多个聊天会话
3. **代码高亮**：对代码块进行语法高亮
4. **导出对话**：导出聊天记录为文本或 PDF
5. **主题切换**：支持浅色/深色主题切换
6. **语音输入**：集成语音识别功能
7. **文件上传**：支持上传代码文件进行分析

### 性能优化
1. 虚拟滚动：处理大量消息时提升性能
2. 防抖处理：优化输入框输入
3. 懒加载：按需加载历史消息
4. Service Worker：离线支持

## 部署

### 构建生产版本
```bash
npm run build
```

生成的文件在 `dist` 目录，可以部署到任何静态文件服务器。

### 推荐部署平台
- Vercel
- Netlify
- GitHub Pages
- 阿里云 OSS
- 腾讯云 COS

### 环境变量配置
生产环境需要配置正确的后端 API 地址，建议使用环境变量：

```javascript
// .env.production
VITE_API_BASE_URL=https://your-backend-api.com
```

## 许可证
MIT License

